# 设计 iter-006: 紧急联系人模块

## 变更摘要

**日期**: 2026-01-15
**版本**: 1.3.0 → 1.4.0
**分支**: feature/iter-006-emergency-contacts
**里程碑**: Emergency Contacts Module

## 迭代目标

实现紧急联系人模块 - Solo Guardian 的核心安全功能。
当用户错过每日签到时，系统将通知其紧急联系人。

## 任务分解

| 任务 ID | 标题 | 优先级 | 依赖 |
|---------|------|--------|------|
| TASK-014 | Database: Add EmergencyContact model | P0 | - |
| TASK-015 | Backend: Emergency contacts module | P0 | TASK-014 |
| TASK-016 | Frontend: Emergency contacts page | P0 | TASK-015 |

## 技术设计

### 数据库模型 (TASK-014)

```prisma
model EmergencyContact {
  id          String   @id @default(uuid())
  userId      String
  name        String
  email       String
  phone       String?
  priority    Int      @default(1)  // 1-5 通知顺序
  isVerified  Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  deletedAt   DateTime?

  user        User     @relation(fields: [userId], references: [id])

  @@unique([userId, email])
  @@unique([userId, priority])
  @@map("emergency_contacts")
}
```

### API 端点 (TASK-015)

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | /api/v1/emergency-contacts | 获取当前用户所有联系人 |
| GET | /api/v1/emergency-contacts/:id | 获取单个联系人 |
| POST | /api/v1/emergency-contacts | 创建联系人 |
| PUT | /api/v1/emergency-contacts/:id | 更新联系人 |
| DELETE | /api/v1/emergency-contacts/:id | 软删除联系人 |
| PUT | /api/v1/emergency-contacts/reorder | 重排序联系人优先级 |

### 前端页面 (TASK-016)

- 联系人列表页 (/contacts)
- 添加/编辑联系人对话框
- 删除确认对话框
- 支持 3 种语言 (en, zh, ja)
- 响应式设计

## 业务规则

1. 每用户最多 5 个紧急联系人
2. 邮箱在用户范围内唯一
3. 优先级 1-5 决定通知顺序
4. 软删除保留历史记录
5. 用户只能访问自己的联系人

## 架构决策 (ADR-010)

- 使用优先级排序 (1-5) 确定通知顺序
- 支持邮箱通知 (MVP)，电话/短信 (未来)
- 软删除模式保留通知历史
- 验证功能推迟到后续迭代

## 创建的文件

- `.claude/handoffs/iter-006/HO-014-emergency-contact-db.yaml`
- `.claude/handoffs/iter-006/HO-015-emergency-contacts-backend.yaml`
- `.claude/handoffs/iter-006/HO-016-emergency-contacts-frontend.yaml`

## 范围外 (Out of Scope)

- 联系人验证流程
- 发送测试通知
- 拖拽排序
- SMS/电话通知
