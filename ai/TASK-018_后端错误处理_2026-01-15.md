# TASK-018: 后端错误处理基础设施

## 概述

创建后端错误处理基础设施，包含 BusinessException 和 GlobalExceptionFilter，提供一致的、支持 i18n 的错误响应。

## 实现内容

### BusinessException 类
位置: `apps/backend/src/common/exceptions/business.exception.ts`

```typescript
export class BusinessException extends HttpException {
  public readonly errorCode: string;
  public readonly category: ErrorCategory;
  public readonly i18nKey: string;
  public readonly details?: Record<string, unknown>;
  public readonly field?: string;

  constructor(
    errorCodeKey: ErrorCodeKey,
    options?: {
      details?: Record<string, unknown>;
      field?: string;
      message?: string;
    },
  ) {
    // 从 ErrorCodes 获取错误定义
    // 构建 ApiErrorResponse 格式的响应体
    // 调用 super() 传递响应体和 HTTP 状态码
  }
}
```

### GlobalExceptionFilter
位置: `apps/backend/src/common/filters/global-exception.filter.ts`

处理三种类型的异常:
1. **BusinessException** - 直接返回已格式化的响应
2. **HttpException** - 映射到适当的错误码
3. **未知错误** - 返回 SYSTEM_INTERNAL_ERROR

日志级别:
- status >= 500 → error 级别（包含堆栈跟踪）
- status < 500 → warn 级别

### main.ts 注册
```typescript
app.useGlobalFilters(new GlobalExceptionFilter());
```

## 使用示例

```typescript
// 在服务中
import { BusinessException } from '../common/exceptions';

async create(userId: string, dto: CreateContactDto) {
  const count = await this.repository.countByUserId(userId);
  if (count >= 5) {
    throw new BusinessException('CONTACT_LIMIT_REACHED', {
      details: { currentCount: count, maxAllowed: 5 },
    });
  }
}
```

## 依赖

- 添加 `@solo-guardian/types` 到 backend 依赖

## 验证

| 检查项 | 状态 |
|--------|------|
| TypeScript 编译 | ✅ 通过 |
| 无 `any` 类型 | ✅ 通过 |
| 使用 NestJS Logger | ✅ 通过 |
