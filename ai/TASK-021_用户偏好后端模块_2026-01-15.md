# TASK-021: 用户偏好后端模块

## 概述

创建 NestJS 模块处理用户偏好的 CRUD 操作，包括功能开关、视觉偏好和引导状态。

## API 端点

| 方法 | 路径 | 描述 |
|------|------|------|
| GET | /api/v1/preferences | 获取用户偏好（不存在则自动创建） |
| PATCH | /api/v1/preferences | 更新用户偏好 |
| PATCH | /api/v1/preferences/features/:featureName | 切换可选功能 |
| POST | /api/v1/preferences/onboarding/complete | 标记引导完成 |

## 文件结构

```
src/modules/user-preferences/
├── dto/
│   ├── index.ts
│   ├── update-preferences.dto.ts
│   └── preferences-response.dto.ts
├── user-preferences.module.ts
├── user-preferences.controller.ts
├── user-preferences.service.ts
└── user-preferences.repository.ts
```

## 实现细节

### UpdatePreferencesDto
- `preferFeaturesOn?: boolean`
- `fontSize?: number` (14-24)
- `highContrast?: boolean`
- `reducedMotion?: boolean`
- `warmColors?: boolean`
- `hobbyCheckIn?: boolean`
- `familyAccess?: boolean`

### Service 方法
- `getOrCreate(userId)` - 获取或创建默认偏好
- `update(userId, dto)` - 更新偏好
- `updateOptionalFeature(userId, featureName, enabled)` - 切换可选功能
- `completeOnboarding(userId)` - 标记引导完成

### 业务规则
- 首次访问时自动创建默认偏好
- fontSize 必须在 14-24 范围内
- optionalFeatures 是 JSON，更新时合并
- 使用 BusinessException 处理错误

## 验证

| 检查项 | 状态 |
|--------|------|
| TypeScript 编译 | ✅ 通过 |
| 模块注册 | ✅ 成功 |
