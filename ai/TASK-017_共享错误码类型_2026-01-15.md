# TASK-017: 共享错误码和类型

## 概述

在 `packages/types` 中创建共享的错误处理类型和错误码，为后端和前端提供一致的错误格式。

## 创建的文件

### packages/types/package.json
- 包名: `@solo-guardian/types`
- 版本: 0.1.0
- TypeScript 类型检查脚本

### packages/types/tsconfig.json
- 目标: ES2020
- 模块: ESNext
- 严格模式

### packages/types/src/errors.ts

#### ErrorCategory 枚举
```typescript
enum ErrorCategory {
  VALIDATION,  // 输入验证错误 (400)
  AUTH,        // 认证/授权错误 (401, 403)
  BUSINESS,    // 业务逻辑错误 (400)
  NOT_FOUND,   // 资源未找到 (404)
  CONFLICT,    // 资源冲突 (409)
  RATE_LIMIT,  // 请求过多 (429)
  SYSTEM,      // 系统内部错误 (500, 503)
}
```

#### 错误码分组
| 分组 | 范围 | 示例 |
|------|------|------|
| Auth | 1xxx | AUTH_1001 - 凭证无效 |
| Validation | 2xxx | VAL_2001 - 验证失败 |
| User | 3xxx | USER_3001 - 用户未找到 |
| Contact | 4xxx | CONTACT_4001 - 联系人未找到 |
| Check-in | 5xxx | CHECKIN_5001 - 今日已签到 |
| Preferences | 6xxx | PREF_6001 - 偏好未找到 |
| System | 9xxx | SYS_9001 - 系统内部错误 |

#### ApiErrorResponse 接口
```typescript
interface ApiErrorResponse {
  success: false;
  error: {
    code: string;
    category: ErrorCategory;
    message: string;
    i18nKey: string;
    details?: Record<string, unknown>;
    field?: string;
    timestamp: string;
  };
}
```

#### 辅助函数
- `isUserError(category)` - 判断是否为用户引起的错误
- `getErrorCode(key)` - 获取错误码定义
- `isApiError(response)` - 类型守卫，判断是否为错误响应

### packages/types/src/index.ts
- 导出所有类型和函数

## 验证

| 检查项 | 状态 |
|--------|------|
| TypeScript 编译 | ✅ 通过 |
| 无 `any` 类型 | ✅ 通过 |
| 所有类型已导出 | ✅ 通过 |

## 依赖关系

- 阻塞: TASK-018, TASK-019
