# TASK-019: 前端错误处理钩子和国际化

## 概述

创建前端错误处理基础设施，包含 useErrorHandler 钩子、错误国际化翻译和 ErrorBoundary 组件。

## 实现内容

### packages/api-client/src/error-handler.ts

#### ParsedError 接口
```typescript
interface ParsedError {
  code: string;
  category: ErrorCategory;
  i18nKey: string;
  message: string;
  field?: string;
  details?: Record<string, unknown>;
  isUserError: boolean;
  isNetworkError: boolean;
}
```

#### parseApiError 函数
处理三种类型的错误:
- 网络错误 (无响应)
- Axios 错误 (带 ApiErrorResponse)
- 未知错误格式

### apps/user-web/src/hooks/useErrorHandler.ts

```typescript
const { handleError, parseApiError } = useErrorHandler();

// 使用示例
try {
  await createContact.mutateAsync(data);
} catch (error) {
  const parsed = handleError(error);
  if (parsed.field) {
    setError(parsed.field, { message: parsed.message });
  }
}
```

功能:
- 使用 i18n 获取翻译消息
- 用户错误显示默认 toast
- 系统错误显示红色警告 toast
- 网络错误显示重试按钮

### apps/user-web/src/components/ErrorBoundary.tsx

React 错误边界组件:
- 捕获 React 渲染错误
- 显示友好的错误页面
- 提供重试和返回按钮
- 记录错误用于调试

### 错误翻译 (i18n)

支持三种语言: 英语、中文、日语

位置: `apps/user-web/src/i18n/locales/{en,zh,ja}/error.json`

翻译内容:
- title.userError / title.systemError
- action.retry / action.goBack
- auth.* (认证错误)
- validation.* (验证错误)
- contact.* (联系人错误)
- checkin.* (签到错误)
- network.* (网络错误)
- system.* (系统错误)

## 额外更改

### ErrorCategory 从 enum 改为 const 对象
由于 user-web 的 tsconfig 启用了 `erasableSyntaxOnly`，enum 语法不被允许。
改为使用 const 对象 + type union:

```typescript
export const ErrorCategory = {
  VALIDATION: 'VALIDATION',
  // ...
} as const;

export type ErrorCategory = (typeof ErrorCategory)[keyof typeof ErrorCategory];
```

### 添加 sonner toast 库
安装 `sonner` 用于显示 toast 通知。

## 验证

| 检查项 | 状态 |
|--------|------|
| TypeScript 编译 (api-client) | ✅ 通过 |
| TypeScript 编译 (user-web) | ✅ 通过 |
| TypeScript 编译 (backend) | ✅ 通过 |
